<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

    <!-- Mathematical Constants -->
    <xacro:include filename="$(find ecm_description)/urdf/xacros/common.xacro" />

    <!-- Macro for da Vinci Endoscope Camera Manipulator (ECM) Base -->
    <xacro:macro name="ecm_base"
        params="prefix parent_link xyz:='-0.612599 0.0 -0.101595' rpy:='0.0 0.0 0.0'">

        <!-- Link 0: Base Link -->
        <link name="${prefix}_base_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://ecm_description/meshes/ecm_base/ecm_base_link.stl" />
                </geometry>
                <material name="">
                    <color rgba="0.64706 0.61961 0.58824 1" />
                </material>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://ecm_description/meshes/ecm_base/ecm_base_link.stl" />
                </geometry>
            </collision>
        </link>

        <!-- Link 1: Yaw Link -->
        <link name="${prefix}_yaw_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://ecm_description/meshes/ecm_base/ecm_yaw_link.stl" />
                </geometry>
                <material name="">
                    <color rgba="0.64706 0.61961 0.58824 1" />
                </material>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://ecm_description/meshes/ecm_base/ecm_yaw_link.stl" />
                </geometry>
            </collision>
        </link>

        <!-- Link 2: Pitch Front Link -->
        <link name="${prefix}_pitch_front_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_pitch_front_link.stl" />
                </geometry>
                <material name="">
                    <color rgba="0.64706 0.61961 0.58824 1" />
                </material>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_pitch_front_link.stl" />
                </geometry>
            </collision>
        </link>

        <!-- Link 3: Pitch Bottom Link -->
        <link name="${prefix}_pitch_bottom_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_pitch_bottom_link.stl" />
                </geometry>
                <material name="">
                    <color rgba="0.25098 0.25098 0.25098 1" />
                </material>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_pitch_bottom_link.stl" />
                </geometry>
            </collision>
        </link>

        <!-- Link 4: Pitch End Link -->
        <link name="${prefix}_pitch_end_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_pitch_end_link.stl" />
                </geometry>
                <material name="">
                    <color rgba="0.89804 0.91765 0.92941 1" />
                </material>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_pitch_end_link.stl" />
                </geometry>
            </collision>
        </link>

        <!-- Link 5: Main Insertion Link -->
        <link name="${prefix}_main_insertion_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_main_insertion_link.stl" />
                </geometry>
                <material name="">
                    <color rgba="0.25 0.25 0.25 1" />
                </material>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_main_insertion_link.stl" />
                </geometry>
            </collision>
        </link>

        <!-- Link 6: Tool Link -->
        <link name="${prefix}_tool_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://ecm_description/meshes/ecm_base/ecm_tool_link.stl" />
                </geometry>
                <material name="">
                    <color rgba="0.7 0.7 0.7 1" />
                </material>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://ecm_description/meshes/ecm_base/ecm_tool_link.stl" />
                </geometry>
            </collision>
        </link>

        <!-- Link 7: Pitch Top Link -->
        <link name="${prefix}_pitch_top_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_pitch_top_link.stl" />
                </geometry>
                <material name="">
                    <color rgba="0.64706 0.51765 0 1" />
                </material>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_pitch_top_link.stl" />
                </geometry>
            </collision>
        </link>

        <!-- Link 8: Pitch Back Link -->
        <link name="${prefix}_pitch_back_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_pitch_back_link.stl" />
                </geometry>
                <material name="">
                    <color rgba="0.64706 0.51765 0 1" />
                </material>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_pitch_back_link.stl" />
                </geometry>
            </collision>
        </link>

        <!-- Link 9: Remote Center Link -->
        <link name="${prefix}_remote_center_link">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_remote_center_link.stl" />
                </geometry>
                <material name="">
                    <color rgba="1.0 0.7 0.7 1" />
                </material>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh
                        filename="package://ecm_description/meshes/ecm_base/ecm_remote_center_link.stl" />
                </geometry>
            </collision>
        </link>

        <!-- Link 10: End Link -->
        <link name="${prefix}_end_link" />

        <!-- Joint 0: Fixed to Setup Joint: Link Parent to Link 0 -->
        <joint name="${prefix}_fixed_joint" type="fixed">
            <parent link="${parent_link}" />
            <child link="${prefix}_base_link" />
            <origin rpy="${rpy}" xyz="${xyz}" />
        </joint>

        <!-- Joint 1: Yaw Joint: Link 0 to Link 1 -->
        <joint name="${prefix}_yaw" type="revolute">
            <origin xyz="0.0731999999999783 0 0.101460000000185" rpy="${PI/2} 0 ${PI/2}" />
            <parent link="${prefix}_base_link" />
            <child link="${prefix}_yaw_link" />
            <axis xyz="0 0 1" />
            <limit lower="-1.595183" upper="1.581733" effort="1000" velocity="10" />
        </joint>

        <!-- Joint 2: Pitch Front Joint: Link 1 to Link 2 -->
        <joint name="${prefix}_pitch" type="revolute">
            <origin xyz="0 0 0.199000000000014" rpy="${PI} -${PI/2} 0" />
            <parent link="${prefix}_yaw_link" />
            <child link="${prefix}_pitch_front_link" />
            <axis xyz="0 0 1" />
            <limit lower="-0.783710" upper="1.157657" effort="1000" velocity="10" />
        </joint>

        <!-- Joint 3: Pitch Bottom Joint: Link 2 to Link 3 -->
        <joint name="${prefix}_pitch_bottom" type="revolute">
            <origin xyz="-0.103000865501078 -0.286804989831434 0" rpy="0 0 0" />
            <parent link="${prefix}_pitch_front_link" />
            <child link="${prefix}_pitch_bottom_link" />
            <axis xyz="0 0 1" />
            <limit lower="-1.157657" upper="0.783710" effort="1000" velocity="10" />
            <mimic joint="${prefix}_pitch" multiplier="-1" />
        </joint>

        <!-- Joint 4: Pitch End Joint: Link 3 to Link 4 -->
        <joint name="${prefix}_pitch_end" type="revolute">
            <origin xyz="0.340400072983362 -0.000135620545844151 0" rpy="0 0 0" />
            <parent link="${prefix}_pitch_bottom_link" />
            <child link="${prefix}_pitch_end_link" />
            <axis xyz="0 0 1" />
            <limit lower="-0.783710" upper="1.157657" effort="1000" velocity="10" />
            <mimic joint="${prefix}_pitch" multiplier="1" />
        </joint>

        <!-- Joint 5: Insertion Joint: Link 4 to Link 5 -->
        <joint name="${prefix}_insertion" type="prismatic">
            <origin xyz="0.042 -0.086143 0" rpy="-${PI/2} 0 0" />
            <parent link="${prefix}_pitch_end_link" />
            <child link="${prefix}_main_insertion_link" />
            <axis xyz="0 0 1" />
            <limit lower="0" upper="0.254193" effort="50" velocity="100" />
        </joint>

        <!-- Joint 6: Roll Joint: Link 5 to Link 6 -->
        <joint name="${prefix}_roll" type="revolute">
            <origin xyz="0.0609999999999996 0 0" rpy="0 0 0" />
            <parent link="${prefix}_main_insertion_link" />
            <child link="${prefix}_tool_link" />
            <axis xyz="0 0 -1" />
            <limit lower="-1.552676" upper="1.566741" effort="1000" velocity="10" />
        </joint>

        <!-- Joint 7: Pitch Top Joint: Link 2 to Link 7 -->
        <joint name="${prefix}_pitch_top" type="revolute">
            <origin xyz="-0.10847228839493 -0.324257434492051 0" rpy="0 0 0" />
            <parent link="${prefix}_pitch_front_link" />
            <child link="${prefix}_pitch_top_link" />
            <axis xyz="0 0 1" />
            <limit lower="-1.157657" upper="0.783710" effort="1000" velocity="10" />
            <mimic joint="${prefix}_pitch" multiplier="-1" />
        </joint>

        <!-- Joint 8: Pitch Back Joint: Link 1 to Link 8 -->
        <joint name="${prefix}_pitch_back" type="revolute">
            <origin xyz="0 -0.00979999999999302 0.162430000000002" rpy="${PI} -${PI/2} 0" />
            <parent link="${prefix}_yaw_link" />
            <child link="${prefix}_pitch_back_link" />
            <axis xyz="0 0 1" />
            <limit lower="-0.783710" upper="1.157657" effort="1000" velocity="10" />
            <mimic joint="${prefix}_pitch" multiplier="1" />
        </joint>

        <!-- Joint 9: Remote Center Joint: Link 0 to Link 9 -->
        <joint name="${prefix}_remote_center" type="fixed">
            <origin xyz="0.612599207482277 0 0.10159534323531" rpy="0 0 -${PI/2}" />
            <parent link="${prefix}_base_link" />
            <child link="${prefix}_remote_center_link" />
            <axis xyz="0 0 0" />
        </joint>

        <!-- Joint 10: End Joint: Link 6 to Link 10 -->
        <joint name="${prefix}_end_joint" type="fixed">
            <origin xyz="0 0 0.37364" rpy="0 0 0" />
            <parent link="${prefix}_tool_link" />
            <child link="${prefix}_end_link" />
            <axis xyz="0 0 0" />
        </joint>

    </xacro:macro>

</robot>